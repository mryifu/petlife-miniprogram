<!-- pages/pets/index.wxml -->
<view class="container">
  <!-- Empty State -->
  <view class="empty-state center flex-col" wx:if="{{pets.length === 0}}">
    <image src="../../images/empty_pet.png" mode="aspectFit" class="empty-img"></image>
    <text class="empty-text">è¿˜æ²¡æœ‰èŒå® æ¡£æ¡ˆå“¦</text>
    <view class="empty-actions">
      <navigator url="/pages/pets/form" class="btn-primary add-btn-large">
        <text>+ æ·»åŠ å® ç‰©</text>
      </navigator>
      <navigator url="/pages/pets/join" class="btn-secondary add-btn-large">
        <text>ğŸ¤ åŠ å…¥å…±å…»</text>
      </navigator>
    </view>
  </view>

  <!-- Pet List -->
  <view class="pet-list" wx:else>
    <view class="section-hint">ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…ï¼Œé•¿æŒ‰ç¼–è¾‘ä¿¡æ¯</view>

    <block wx:for="{{pets}}" wx:key="_id">
      <!-- èº«ä»½è¯æ ·å¼å¡ç‰‡ -->
      <view class="pet-id-card" bindtap="selectPet" bindlongpress="editPet" data-id="{{item._id}}">
        <!-- é¡¶éƒ¨è£…é¥°æ¡ -->
        <view class="card-header">
          <text class="card-title">ğŸ¾ å® ç‰©èº«ä»½è¯</text>
          <view class="card-number">No.{{index + 1}}</view>
        </view>

        <!-- ä¸»è¦ä¿¡æ¯åŒº -->
        <view class="card-body">
          <!-- å·¦ä¾§å¤´åƒ -->
          <view class="avatar-section">
            <image class="pet-avatar-large" src="{{item.avatar || '/images/default_avatar.png'}}" mode="aspectFill"></image>
            <view class="gender-badge {{item.gender}}">
              {{item.gender === 'male' ? 'â™‚' : 'â™€'}}
            </view>
          </view>

          <!-- å³ä¾§ä¿¡æ¯ -->
          <view class="info-section">
            <view class="name-row">
              <text class="pet-name-large">{{item.name}}</text>
              <view class="neutered-badge" wx:if="{{item.is_neutered}}">å·²ç»è‚²</view>
            </view>

            <view class="info-grid">
              <view class="info-item">
                <text class="info-label">å“ç§</text>
                <text class="info-value">{{item.species}}</text>
              </view>
              <view class="info-item">
                <text class="info-label">å¹´é¾„</text>
                <text class="info-value">{{item.ageStr}}</text>
              </view>
              <view class="info-item">
                <text class="info-label">ç”Ÿæ—¥</text>
                <text class="info-value">{{item.birthday || 'æœªè®¾ç½®'}}</text>
              </view>
              <view class="info-item">
                <text class="info-label">æ˜Ÿåº§</text>
                <text class="info-value">{{item.zodiac || 'æœªçŸ¥'}}</text>
              </view>
              <view class="info-item">
                <text class="info-label">ä½“é‡</text>
                <text class="info-value">{{item.weight}}kg</text>
              </view>
              <view class="info-item">
                <text class="info-label">æ¯›è‰²</text>
                <text class="info-value">{{item.color || 'æœªè®¾ç½®'}}</text>
              </view>
            </view>

            <!-- æ€§æ ¼æ ‡ç­¾ -->
            <view class="personality-row" wx:if="{{item.personality}}">
              <text class="personality-label">æ€§æ ¼ï¼š</text>
              <view class="personality-tag">{{item.personality}}</view>
            </view>
          </view>
        </view>

        <!-- åº•éƒ¨æ“ä½œåŒº -->
        <view class="card-footer">
          <view class="footer-item" catchtap="viewWeightChart" data-id="{{item._id}}">
            <text class="footer-icon">ğŸ“Š</text>
            <text class="footer-text">ä½“é‡</text>
          </view>
          <view class="footer-item" catchtap="viewBills" data-id="{{item._id}}">
            <text class="footer-icon">ğŸ’°</text>
            <text class="footer-text">æ¶ˆè´¹</text>
          </view>
          <view class="footer-item" catchtap="viewMembers" data-id="{{item._id}}">
            <text class="footer-icon">ğŸ‘¥</text>
            <text class="footer-text">æˆå‘˜{{item.memberCount > 1 ? '(' + item.memberCount + ')' : ''}}</text>
          </view>
          <view class="footer-item" catchtap="editPet" data-id="{{item._id}}">
            <text class="footer-icon">âœï¸</text>
            <text class="footer-text">ç¼–è¾‘</text>
          </view>
        </view>

        <!-- å½“å‰é€‰ä¸­æ ‡è¯† -->
        <view class="selected-badge" wx:if="{{item.isSelected}}">
          <text>å½“å‰å® ç‰©</text>
        </view>
      </view>
    </block>

    <!-- æ·»åŠ æŒ‰é’® -->
    <navigator url="/pages/pets/form" class="add-pet-btn">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ æ–°å® ç‰©</text>
    </navigator>

    <!-- åŠ å…¥å…±å…»æŒ‰é’® -->
    <navigator url="/pages/pets/join" class="join-pet-btn">
      <text class="join-icon">ğŸ¤</text>
      <text class="join-text">åŠ å…¥å…±å…»</text>
    </navigator>
  </view>
</view>
